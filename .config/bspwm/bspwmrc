#!/bin/sh
source ~/.dotfiles/.config/bspwm/vars

if [ $(cat /etc/hostname) = "laptop"  ]; then
    source ~/.dotfiles/.config/bspwm/vars-laptop
fi

# Set wallpaper
#feh --bg-scale --no-fehbg ~/.dotfiles/.config/bspwm/wallpaper.jpg
wal -i ~/.dotfiles/.config/bspwm/wallpaper.jpg

# Function for running startup programs
function run_once {
    if [ -z $(pgrep -x $1) ]; then
        $1 $2 &
    fi
}

# Run background tasks
killall -q sxhkd; sxhkd &
killall -q picom; sleep 0.3s; picom &
killall -q polybar; polybar mainbar-bspwm &

run_once redshift
run_once nextcloud
run_once ckb-next "-b"

# Mouse and touchpad options
xinput --set-prop $MOUSE_DEVID 'libinput Accel Speed' $MOUSE_ACCEL

if [ ! -z "$TOUCHPAD_DEVID"  ]; then
    xinput --set-prop $TOUCHPAD_DEVID 'libinput Accel Speed' $TOUCHPAD_ACCEL
    xinput --set-prop $TOUCHPAD_DEVID 'libinput Tapping Enabled' 1
    xinput --set-prop $TOUCHPAD_DEVID 'libinput Natural Scrolling Enabled' 1
fi

# Keyboard speed
xset r rate $KEYBOARD_DELAY $KEYBOARD_RATE

# Xorg settings
xsetroot -cursor_name left_ptr &

# bspwm config
## Monitors
bspc monitor $MONITOR -d 1 2 3 4 5

## Rules
bspc rule -a Zathura state=tiled

## Other
bspc config focus_follows_pointer true
bspc config window_gap 10
bspc config top_padding 20
bspc config border_width 2

# Control lights on login
~/.dotfiles/scripts/autohue/login.sh

